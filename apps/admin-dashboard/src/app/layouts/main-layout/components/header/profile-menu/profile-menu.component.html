@if (authService.isAuthenticated()) {
  <!-- Profile Menu (When Logged In) -->
  <div class="relative ml-3" (clickOutside)="isOpen = false">
    <!-- Profile Button -->
    <button
      (click)="toggleMenu()"
      class="bg-card relative flex rounded-full text-sm"
      type="button"
    >
      <span class="sr-only">Open user menu</span>
      <img
        class="h-9 w-9 rounded-md"
        src="https://avatars.githubusercontent.com/u/12519008?v=4"
        alt=""
      />
    </button>

    <!-- Dropdown -->
    @if (isOpen) {
      <div
        [class]="
          isOpen
            ? 'visible translate-y-0 scale-100 opacity-100'
            : 'invisible -translate-y-5 scale-95 opacity-0'
        "
        class="bg-background shadow-custom ring-opacity-5 absolute right-0 z-20 mt-2 w-60 origin-top-right transform rounded-md py-4 ring-1 ring-transparent transition focus:outline-hidden"
      >
        <!-- User Info -->
        <div class="flex flex-row items-center px-4 pb-4">
          <div class="w-10 shrink-0">
            <img
              class="rounded-md"
              src="https://avatars.githubusercontent.com/u/12519008?v=4"
              alt=""
            />
          </div>
          <div
            class="text-foreground overflow-hidden px-2 text-sm font-semibold"
          >
            Alessandro Incantalupo
            <p
              class="text-muted-foreground truncate text-xs font-semibold text-ellipsis"
            >
              me&#64;lanno.dev
            </p>
          </div>
        </div>
        <div class="border-border border-b border-dashed"></div>

        <!-- Menu Items -->
        <ul class="mx-4 my-2 flex flex-col">
          @for (item of profileMenu; track $index) {
            <li
              (click)="toProfile(item.link)"
              class="text-muted-foreground hover:bg-card hover:text-primary inline-flex cursor-pointer items-center gap-2 rounded-md px-3 py-2 text-xs font-semibold"
            >
              <svg-icon
                src="{{ item.icon }}"
                [svgClass]="'h-5 w-5 text-muted-foreground/50'"
              ></svg-icon>
              {{ item.title }}
            </li>
          }
        </ul>

        <hr class="border-border border-dashed" />

        <!-- Theme Selector -->
        <div class="mx-4 my-2">
          <span class="text-foreground text-xs font-semibold">Color</span>
          <div class="mt-2 grid grid-cols-2 gap-2">
            @for (item of themeStore.getThemeColors(); track $index) {
              <div
                (click)="themeStore.setColor(item.name)"
                [class]="{
                  'border-muted-foreground bg-card':
                    item.name == themeStore.color(),
                  'border-primary': item.name == themeStore.color(),
                }"
                class="focus-visible:ring-ring border-border bg-background text-muted-foreground hover:bg-card hover:text-foreground inline-flex h-8 cursor-pointer items-center justify-start rounded-md border px-3 text-xs font-medium whitespace-nowrap shadow-xs transition-colors focus-visible:ring-1 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
              >
                <span
                  [style.background-color]="item.name"
                  class="mr-1 flex h-5 w-5 shrink-0 -translate-x-1 items-center justify-center rounded-full"
                ></span>
                <p class="capitalize">{{ item.name }}</p>
              </div>
            }
          </div>
        </div>

        <!-- Theme Mode -->
        <div class="mx-4 my-2">
          <span class="text-foreground text-xs font-semibold">Mode</span>
          <div class="mt-2 grid grid-cols-1">
            <label class="swap swap-rotate cursor-pointer">
              <input
                type="checkbox"
                class="sr-only"
                [checked]="themeStore.mode() === 'dark'"
                (change)="themeStore.toggleMode()"
                aria-label="Toggle dark mode"
              />
              <!-- Sun icon -->
              <svg
                class="swap-off h-10 w-10 fill-current"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
              >
                <path
                  d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"
                />
              </svg>
              <!-- Moon icon -->
              <svg
                class="swap-on h-10 w-10 fill-current"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
              >
                <path
                  d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"
                />
              </svg>
            </label>
          </div>
        </div>

        <hr class="border-border border-dashed" />

        <!-- Logout Button -->
        <div class="mx-4 my-2">
          <button
            (click)="logout()"
            class="w-full rounded-md px-3 py-2 text-xs font-semibold text-red-500 hover:bg-red-50"
          >
            Logout
          </button>
        </div>
      </div>
    }
  </div>
} @else {
  <!-- If NOT Logged In, Show Login Button -->
  <div class="relative ml-3">
    <a
      (click)="signIn()"
      class="bg-primary hover:bg-primary-dark rounded-md px-4 py-2 text-sm font-semibold text-white transition"
    >
      Sign In
    </a>
  </div>
}
